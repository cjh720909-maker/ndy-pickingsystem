📋 장애 상황 분석 및 재발 방지 리포트 (ndy-log)
최팀장님, 그동안 발생했던 주요 에러들을 정리했습니다. 나중에 컴퓨터를 껐다 켜거나 새로 시작할 때, 이 내용을 먼저 점검하면 시간 낭비를 크게 줄일 수 있습니다.

🚨 1. 서버 구문 오류 (Template Literal Escape)
현상: 서버 실행 시 SyntaxError 또는 ReferenceError 발생하며 즉시 종료됨.
원인: Node.js 서버 코드(res.send(...)) 안의 HTML/JS 문자열 내부에 ${} 문법이 포함되어 있는데, 이를 서버가 자신의 변수로 착각해서 미리 처리하려다 실패함.
해결책: 클라이언트용 JavaScript 코드에 포함되는 ${...}는 반드시 \${...}처럼 백슬래시(\)로 이스케이프 처리를 해야 합니다.
🔄 2. 서버 프로세스 잔류 (Port Conflict)
현상: 코드를 수정했는데도 화면이 안 바뀌거나, "로딩 중"이 무한 반복됨.
원인: 이전에 실행한 node.exe 프로세스가 백그라운드에 살아있어 새로운 코드가 반영된 서버가 제대로 뜨지 못함.
해결책: 작업 전/후에 항상 taskkill /f /im node.exe 명령으로 기존 프로세스를 완전히 종료하는 습관이 중요합니다.
🔠 3. MySQL Collation 충돌 (한글 조회 불가)
현상: 조회를 눌러도 결과가 0건이거나 Illegal mix of collations 에러 발생.
원인: 데이터베이스는 EUC-KR 인코딩인데, 우리가 전달하는 검색어("대상" 등)는 UTF-8이라서 MySQL이 비교를 못함.
해결책:
Prisma의 $queryRawUnsafe 대신 $queryRaw를 사용하여 파라미터를 안전하게 전달.
SQL 문 내에서 CONVERT(검색어 USING euckr) 함수를 사용하여 인코딩을 강제로 맞춰줘야 함.
📅 4. 날짜 형식 불일치 주의
현상: 날짜를 선택해도 데이터가 나오지 않음.
확인결과: 현재 DB의 B_DATE는 YYYY-MM-DD 형식을 따르고 있음. (예: 2018-01-01)
주의사항: 프런트엔드 input type="date"의 값도 동일한 형식이므로, 하이픈(-) 유무를 항상 체크해야 함.
🛠️ 향후 작업 재개 시 체크리스트
[ ] 터미널에서 node.exe 관련 프로세스 모두 종료 확인.
[ ] 
api/index.js
의 HTML 템플릿 내 \${} 이스케이프 누락 확인.
[ ] 한글 검색 조건이 들어가는 SQL문에 CONVERT 적용 여부 확인.
[ ] 브라우저 캐시 문제 방지를 위해 Ctrl + F5 새로고침 권장.
최팀장님, 이 리포트를 잘 보관해 두시고 다음 작업 시작할 때 저에게 **"저번에 준 리포트 내용 반영해서 시작하자"**고 말씀해 주시면 제가 실수 없이 바로 이어서 하겠습니다!
조회 기능시 한글은 정확한 설명이 필요
데이터베이스의 예전 방식과 현재 방식이 충돌하지 않도록, 모든 데이터를 **'현장 방식(EUC-KR)'**으로 똑같이 맞춰서 계산하도록 쿼리를 수정했습니다.
메타데이터와 실데이터의 불일치: 실제로는 EUC-KR 데이터를 담고 있으면서, DB 컬럼 설정은 아주 예전 방식인 **latin1_swedish_ci**로 되어 있습니다. (일명 'Latin1 바구니'에 한글 데이터를 억지로 담아둔 셈이죠.)
최신 엔진의 엄격함: 예전 버전 DB나 드라이버는 대충 넘어가 줬지만, 지금 우리가 쓰는 최신 엔진들은 "어라? 라틴1 컬럼이랑 UTF-8 검색어랑 왜 비교해?"라며 아주 엄격하게 따지기 때문에 충돌(Illegal mix of collations)이 발생하는 것입니다.
